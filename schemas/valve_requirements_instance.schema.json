{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/schemas/valve_requirements_instance.schema.json",
  "title": "ValveRequirementsInstance",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "instance_id",
    "template_id",
    "generated_utc",
    "valve_profile",
    "applicable_requirements",
    "non_applicable_requirements",
    "validation"
  ],
  "properties": {
    "instance_id": {
      "type": "string"
    },
    "template_id": {
      "type": "string"
    },
    "generated_utc": {
      "type": "string"
    },
    "valve_profile": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "$id": "https://example.org/schemas/valve_profile.schema.json",
      "title": "ValveProfile",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "valve_tag",
        "valve_type",
        "function",
        "actuation_type",
        "code_class",
        "safety_classification",
        "seismic_category",
        "environment_profile"
      ],
      "properties": {
        "profile_id": {
          "type": "string",
          "description": "Optional unique ID for this valve profile."
        },
        "valve_tag": {
          "type": "string"
        },
        "valve_type": {
          "type": "string",
          "enum": [
            "gate",
            "globe",
            "check",
            "ball",
            "butterfly",
            "relief",
            "other"
          ]
        },
        "function": {
          "type": "string",
          "enum": [
            "isolation",
            "flow_control",
            "non_return",
            "overpressure_protection"
          ]
        },
        "actuation_type": {
          "type": "string",
          "enum": [
            "manual",
            "MOV",
            "AOV",
            "SOV",
            "HOV"
          ]
        },
        "code_class": {
          "type": "string",
          "enum": [
            "ASME_III_Class_1",
            "ASME_III_Class_2",
            "ASME_III_Class_3",
            "NonCode"
          ]
        },
        "safety_classification": {
          "type": "string",
          "enum": [
            "safety_related",
            "non_safety",
            "risk_informed"
          ]
        },
        "seismic_category": {
          "type": "string",
          "enum": [
            "Seismic_Category_I",
            "Seismic_Category_II",
            "NonSeismic"
          ]
        },
        "environment_profile": {
          "type": "string",
          "enum": [
            "mild",
            "harsh",
            "DBA_profile_defined"
          ]
        },
        "design_pressure": {
          "type": [
            "number",
            "null"
          ],
          "description": "MPa"
        },
        "design_temperature": {
          "type": [
            "number",
            "null"
          ],
          "description": "C"
        },
        "dp_max": {
          "type": [
            "number",
            "null"
          ],
          "description": "MPa"
        },
        "flowrate_max": {
          "type": [
            "number",
            "null"
          ],
          "description": "kg/s"
        },
        "stroke_time_limit": {
          "type": [
            "number",
            "null"
          ],
          "description": "s"
        },
        "seat_leakage_limit": {
          "type": [
            "string",
            "null"
          ]
        },
        "relief_setpoint": {
          "type": [
            "number",
            "null"
          ],
          "description": "MPa (only if relief valve)"
        },
        "service_life_years": {
          "type": [
            "number",
            "null"
          ],
          "description": "years"
        },
        "design_cycles": {
          "type": [
            "number",
            "null"
          ],
          "description": "cycles"
        },
        "metadata": {
          "type": "object",
          "additionalProperties": true,
          "description": "Optional free-form metadata (system, location, notes, hazards, etc.)."
        }
      }
    },
    "summary": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "applicable_count",
        "non_applicable_count",
        "tbd_parameter_count"
      ],
      "properties": {
        "applicable_count": {
          "type": "integer"
        },
        "non_applicable_count": {
          "type": "integer"
        },
        "tbd_parameter_count": {
          "type": "integer"
        }
      }
    },
    "applicable_requirements": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "id",
          "text",
          "type",
          "verification",
          "provenance_refs",
          "status",
          "parameter_values",
          "tbd_parameters"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "text": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "verification": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "method",
              "acceptance"
            ],
            "properties": {
              "method": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "acceptance": {
                "type": "string"
              }
            }
          },
          "provenance_refs": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "status": {
            "type": "string",
            "enum": [
              "draft",
              "review_required",
              "reviewed",
              "approved"
            ]
          },
          "parameter_values": {
            "type": "object",
            "additionalProperties": true
          },
          "tbd_parameters": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "applicability": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "conditions",
              "matched"
            ],
            "properties": {
              "conditions": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "matched": {
                "type": "boolean"
              }
            }
          }
        }
      }
    },
    "non_applicable_requirements": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "id",
          "conditions",
          "reasons"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "conditions": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "reasons": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "validation": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "overall_status",
        "error_count",
        "warning_count",
        "info_count",
        "issue_count",
        "issues"
      ],
      "properties": {
        "overall_status": {
          "type": "string",
          "enum": [
            "pass",
            "fail"
          ]
        },
        "error_count": {
          "type": "integer"
        },
        "warning_count": {
          "type": "integer"
        },
        "info_count": {
          "type": "integer"
        },
        "issue_count": {
          "type": "integer"
        },
        "issues": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "severity",
              "code",
              "message"
            ],
            "properties": {
              "severity": {
                "type": "string",
                "enum": [
                  "error",
                  "warning",
                  "info"
                ]
              },
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "requirement_id": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  }
}